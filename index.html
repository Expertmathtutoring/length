<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>Length Mastery Game ‚Äì Stage 4 (Fixed)</title>

<!-- React / ReactDOM UMD -->
<script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
<script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

<!-- Babel (for in-browser JSX compilation) -->
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

<!-- Tailwind (optional styling) -->
<script src="https://cdn.tailwindcss.com"></script>

<style>
  body { background:#e3f2fd; font-family:"Poppins",sans-serif; }
  .fireworks { animation: boom 0.8s ease-in-out; font-size:60px; pointer-events: none; }
  @keyframes boom { from{transform:scale(0);} to{transform:scale(1);} }
</style>
</head>

<body class="min-h-screen flex items-center justify-center p-4">
  <div id="root" class="w-full max-w-3xl"></div>

  <!-- Use Babel so the JSX in this script is compiled in-browser -->
  <script type="text/babel">
  const { useState } = React;

  /* ------------------------------
        NORMALISE INPUT
  ------------------------------ */
  function norm(x) {
    if (!x) return "";
    return x.toString()
            .replace(/\s+/g,"")
            .replace(/‚àí/g,"-")
            .replace(/√ó/g,"*")
            .replace(/√∑/g,"/")
            .toLowerCase();
  }

  /* ------------------------------
        CHECK ANSWER (flexible)
  ------------------------------ */
  function isCorrect(input, expectedList) {
    const n = norm(input);
    const vals = Array.isArray(expectedList) ? expectedList : [expectedList];

    for (let ans of vals) {
      const e = norm(ans);

      // exact match
      if (n === e) return true;

      // numeric equivalence
      const nNum = parseFloat(n);
      const eNum = parseFloat(e);
      if (!isNaN(nNum) && !isNaN(eNum) && Math.abs(nNum - eNum) < 1e-9) return true;

      // fraction or expression equivalence (evaluate safely)
      if (n.includes('/') || e.includes('/')) {
        try {
          const fn = Function('"use strict"; return (' + n + ')')();
          const fe = Function('"use strict"; return (' + e + ')')();
          if (!isNaN(fn) && !isNaN(fe) && Math.abs(fn - fe) < 1e-9) return true;
        } catch (err) { /* ignore eval errors */ }
      }
    }

    return false;
  }

  /* ------------------------------
        QUESTION BANK
  ------------------------------ */
  const bank = {
    Conversions: [
      {q:"Convert 5 m to cm", ans:["500","500cm"], hint:"1 m = 100 cm"},
      {q:"Convert 320 cm to m", ans:["3.2","3.2m"], hint:"Divide by 100"},
      {q:"Convert 8 km to m", ans:["8000","8000m"], hint:"1 km = 1000 m"},
      {q:"Convert 4500 mm to m", ans:["4.5","4.5m"], hint:"1000 mm = 1 m"},
      {q:"Convert 2.6 m to mm", ans:["2600","2600mm"], hint:"Multiply by 1000"},
      {q:"Convert 1200 mm to cm", ans:["120","120cm"], hint:"10 mm = 1 cm"},
      {q:"Convert 0.75 m to cm", ans:["75","75cm"], hint:"Multiply by 100"},
    ],

    Perimeter: [
      {q:"Square side = 9 cm. Perimeter?", ans:["36","36cm"], hint:"4 √ó side"},
      {q:"Rectangle 7 cm √ó 4 cm. Perimeter?", ans:["22","22cm"], hint:"2(l+w)"},
      {q:"Triangle sides: 6 cm, 8 cm, 10 cm", ans:["24","24cm"], hint:"Add all"},
    ],

    Composite: [
      {q:"L-shape sides 4,3,2,3,2,3 (cm)", ans:["17","17cm"], hint:"Add outside edges"},
      {q:"U-shape edges: 6,3,2,3,6,3 (m)", ans:["23","23m"], hint:"Trace outline"},
    ],

    WordProblems: [
      {q:"A rope is 3.5 m. Cut 120 cm off. Remaining?", ans:["2.3","2.3m","230cm"], hint:"120cm = 1.2m"},
      {q:"Walk 800 m to school + return. km?", ans:["1.6","1.6km"], hint:"Convert m‚Üíkm"},
    ]
  };

  /* ------------------------------
        TOOLBAR KEYS
  ------------------------------ */
  const keys = ["0","1","2","3","4","5","6","7","8","9",".","/","cm","m","mm","km","-","(",")"];

  /* ------------------------------
        FIREWORKS
  ------------------------------ */
  function Fire({show}) {
    if (!show) return null;
    return <div className="fireworks absolute inset-0 flex justify-center mt-10">üéâ</div>;
  }

  /* ------------------------------
        MAIN GAME
  ------------------------------ */
  function Game() {
    const tabs = [...Object.keys(bank), "Restart"];

    const [tab, setTab] = useState("Conversions");
    const [i, setI] = useState(0);
    const [inp, setInp] = useState("");
    const [fb, setFb] = useState("");
    const [hint, setHint] = useState(false);
    const [boom, setBoom] = useState(false);
    const [score, setScore] = useState(0);

    function restartGame() {
      setTab("Conversions");
      setI(0);
      setInp("");
      setFb("");
      setHint(false);
      setScore(0);
    }

    if (tab === "Restart") {
      return (
        <div className="p-8 bg-white rounded-xl shadow-xl text-center">
          <h2 className="text-2xl font-bold mb-4">üîÑ Restart Game</h2>
          <button
            className="bg-red-500 text-white px-6 py-2 rounded text-xl"
            onClick={restartGame}
          >
            Restart Now
          </button>
        </div>
      );
    }

    const qList = bank[tab];
    const item = qList[i];

    function check() {
      if (!item) return;
      if (isCorrect(inp, item.ans)) {
        setFb("‚úî Correct!");
        setBoom(true);
        setScore(s => s + 1);

        setTimeout(() => setBoom(false), 800);

        setTimeout(() => {
          setI(n => (n + 1) % qList.length);
          setInp("");
          setFb("");
          setHint(false);
        }, 900);
      } else {
        setFb("‚úñ Incorrect ‚Äî try again");
        setHint(true);
      }
    }

    return (
      <div className="relative p-6 bg-white rounded-xl shadow-xl w-full">
        <Fire show={boom} />

        <h1 className="text-3xl font-bold text-blue-700 text-center mb-4">üìè Length Mastery Game</h1>

        <div className="flex gap-2 justify-center mb-6">
          {tabs.map(t => (
            <button
              key={t}
              onClick={() => setTab(t)}
              className={
                "px-4 py-1 rounded " +
                (t === tab ? "bg-blue-700 text-white" :
                 t === "Restart" ? "bg-red-500 text-white" :
                 "bg-blue-400 text-white")
              }
            >
              {t}
            </button>
          ))}
        </div>

        {item ? (
          <>
            <div className="text-xl mb-4 text-center font-semibold">{item.q}</div>

            <input
              value={inp}
              placeholder="Enter answer"
              className="border w-full p-2 mb-4 rounded"
              onChange={e => setInp(e.target.value)}
              onKeyDown={e => { if (e.key === "Enter") check(); }}
            />

            <div className="flex flex-wrap gap-2 justify-center mb-5">
              {keys.map(k => (
                <button key={k} className="px-2 py-1 bg-gray-200 rounded" onClick={() => setInp(v => v + k)}>{k}</button>
              ))}
            </div>

            <div className="flex justify-center gap-3 mb-3">
              <button onClick={check} className="bg-green-600 text-white px-4 py-1 rounded">Check</button>
              <button onClick={() => setHint(h => !h)} className="bg-yellow-500 text-white px-4 py-1 rounded">Hint</button>
            </div>

            {hint && <div className="bg-yellow-100 p-2 rounded text-center mb-2">{item.hint}</div>}
            {fb && (
              <div className={"text-center p-2 rounded " + (fb.includes("Correct") ? "bg-green-100 text-green-700" : "bg-red-100 text-red-700")}>
                {fb}
              </div>
            )}
            <div className="text-center mt-4 font-semibold text-lg">Score: {score}</div>
          </>
        ) : (
          <div className="text-center">No questions found for this tab.</div>
        )}
      </div>
    );
  }

  ReactDOM.createRoot(document.getElementById("root")).render(<Game />);
  </script>
</body>
</html>



